# Rime schema settings
# encoding: utf-8

__include: sbfm.schema.yaml:/

schema:
  __include: sbfm.schema.yaml:/schema
  schema_id: sbfx
  name: "声笔飞讯"

switches:
  __include: sbfm.schema.yaml:/switches
  __append:
    - name: fast_pop
      reset: 0
      states: [ 慢顶, 快顶 ]

speller:
  __include: sbfm.schema.yaml:/speller
  max_code_length: 7
  popping:
    # 单字三码顶
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z][aeiou]+"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 单字四二顶
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv]"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
      prefix: 2
    # 快顶模式下，声笔字结尾的单字也可以四二顶
    - when: fast_pop
      match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv]"
      accept: "[aeiou]"
      prefix: 2
    # 单字五二顶
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv][aeiou]"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
      prefix: 2
    # 单字模式下的单字二码顶
    - when: pro_char
      match: "[bpmfdtnlgkhjqxzcsrywv][a-z]"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 常规的词组顶
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv][aeiou]{2,4}"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 第四码大写的多字词
    - match: "[bpmfdtnlgkhjqxzcsrywv]{4}[aeiou]{0,2}"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 增强模式词组顶
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv][23789][aeiou]{0,3}"
      accept: "[bpmfdtnlgkhjqxzcsrywv]"
    # 顶数选字词
    - match: "[bpmfdtnlgkhjqxzcsrywv][a-z]?[0-9]"
      accept: "."
    # 如果输入是四码以上，数字可以随便顶
    - match: ".{4,}"
      accept: "[0123456789]"
    # 如果不是增强模式，数字一码或二码之后可以顶
    - when_not: is_enhanced
      match: "[bpmfdtnlgkhjqxzcsrywv][a-z]?"
      accept: "[0123456789]"
    # 如果不是快顶模式，数字三码之后可以顶
    - when_not: fast_pop
      match: "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv]"
      accept: "[0123456789]"

translator:
  __include: sbfm.schema.yaml:/translator
  dictionary: sbfx
  disable_user_dict_for_patterns:
    - "[bpmfdtnlgkhjqxzcsrywv][a-z]?[0123456789aeuio_]*"

punctuator:
  import_preset: sbxlm

recognizer:
  import_preset: sbxlm
  patterns:
    retention: "^[qwrtsdfgzxcvbyphjklnm][aeuio]{1,2}$"

key_binder:
  import_preset: sbxlm

menu:
  __include: sbfm.schema.yaml:/menu
  alternative_select_patterns:
    - "[bpmfdtnlgkhjqxzcsrywv][a-z][aeuio]{2}"
    - "[bpmfdtnlgkhjqxzcsrywv]{4}[aeuio]{2}"
    - "[bpmfdtnlgkhjqxzcsrywv][a-z][bpmfdtnlgkhjqxzcsrywv][aeuio]{4}"
